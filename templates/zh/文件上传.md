# 【1】【2】【3】【7】文件上传漏洞

# 受影响产品名称

- 【4】

## 供应商主页

- 【5】

# 受影响及/或已修复版本

## 提交者

- 【6】

## 受影响文件

- 【7】

## 版本

- 【3】

## 软件链接

- 【8】

# 问题类型

## 漏洞类型

- 无限制文件上传

## 根本原因

- 在'【4】'项目的'【7】'文件中发现了一处文件无限制上传漏洞。此问题的根源在于系统未能对上传文件的类型、格式或内容进行充分验证。攻击者可通过绕过简单的检查（例如，仅验证文件扩展名而未进行MIME类型验证或内容检查）上传恶意文件（如PHP脚本），这些文件随后在服务器上执行。

## 影响

- 攻击者可利用此文件上传漏洞上传恶意脚本，获取服务器端代码执行权限，访问或修改敏感数据，完全控制服务器，或传播恶意软件，对系统安全性和数据机密性构成严重威胁。

# 描述

- 在对"【4】"进行安全审查期间，我在"【7】"文件中发现了一个关键的文件上传漏洞。该漏洞的出现是由于用于上传文件的'file'参数验证不足。攻击者可以绕过系统的薄弱检查（例如，将恶意文件扩展名更改为允许的类型）并上传可执行脚本，从而导致未经授权的服务器访问。需要立即采取补救措施以保护系统安全。

# 【15】

# 漏洞详情与概念验证

## 漏洞位置：

- /upload.php 中的 'file' 参数

## 概念验证：

```
---
【11】
---
```

## 以下是对文件上传过程进行测试后获得的一些具体信息的截图：

```bash
# 验证已上传恶意文件的示例命令
curl http://target.com/uploads/shell.php?cmd=whoami
```

【13】

# 修复建议

1.  **严格的文件类型验证：**
    *   结合使用MIME类型检查、文件签名（魔数）验证和允许的扩展名白名单（避免使用黑名单，因为可能被绕过）来验证文件类型。
    *   拒绝不符合预期类型的文件，即使其扩展名在允许范围内。

2.  **安全的文件存储：**
    *   将上传的文件存储在Web根目录之外的目录中（如果不需要直接执行），以防止直接访问。
    *   为上传的文件生成随机文件名（而不是使用原始名称），以避免路径遍历并确保唯一性。

3.  **执行权限限制：**
    *   通过服务器配置（例如，Apache的.htaccess或Nginx配置）禁用上传目录的PHP执行权限。

4.  **内容检查：**
    *   使用防病毒软件或专用安全工具扫描上传的文件，以检测隐藏的恶意内容。

5.  **输入大小限制：**
    *   限制允许上传的最大文件大小，以防止大型恶意文件消耗服务器资源。
    *   实施服务器端验证，确保文件大小不超过允许的限制。

6.  **定期安全审计：**
    *   定期进行安全审计和漏洞评估，以识别和解决可能出现的新的文件上传漏洞。
    *   及时了解最新的安全最佳实践，并根据需要应用补丁或更新。 